/** SortableDL (requires jQuery)
  * http://github.com/up/sortable-dl
  * Copyright (c) 2011 Uli Preuss
  * published under MIT License (http://www.opensource.org/licenses/mit-license.php)
*/
var SortableDL=function(){return function(){var p=[],k=[["sdl-first",1],["sdl-previous",1],["sdl-next",2],["sdl-last",null]],n=[],d={asc:"asc",desc:"desc",column:""},l="",e={items:null,numbers:null},i=1,f=1,o=0,q=false,j=null,m=null,h=this;this.init=function(a){l=a.id;j=a.classes;m=a.pagination;d.asc=j!==undefined&&j.asc!==undefined?j.asc:d.asc;d.desc=j!==undefined&&j.desc!==undefined?j.desc:d.desc;d.column=j!==undefined&&j.column!==undefined?j.column:d.column;e.items=m!==undefined&&m.items!==undefined? m.items:e.items;e.numbers=m!==undefined&&m.numbers!==undefined?m.numbers:e.numbers;this.getRows();this.countPages();k[3][1]=i;m!==undefined&&this.pagination();this.addSortableLinks(a.columns);this.getData();this.addRows(o)};this.countPages=function(){e.items=e.items!==null?e.items:n.length;i=Math.ceil((n.length-1)/e.items)};this.pagination=function(){$("span.sdl-matches").each(function(){$(this).html(n.length-1)});$("span.sdl-pages").each(function(){$(this).html(i)});if(i===1)$("span.sdl-links").css("display", "none");else{$.each(k,function(a){$("span."+k[a][0]).click(function(){f=k[a][1];if(f<=1)k[0][1]=1;k[1][1]=f>1?f-1:1;k[2][1]=f<i?f+1:i;h.updatePager();h.addRows(o);d.column!==""&&h.toggleColClass(o)}).css("cursor","pointer")});h.updatePager()}};this.updatePager=function(){var a=e.numbers!==null?Math.round((e.numbers-1)/2):0;e.numbers=e.numbers!==null?e.numbers:i;var c=0;$("span.sdl-number-links").empty();$.each(n,function(b){if(!(e.numbers<=c))if(e.numbers===null||b<=e.numbers&&b>=f-a||b<i-e.numbers+ a+1&&b>i-e.numbers&&b<=f+a||b>=f-a&&b<=f+a)if(b!==0&&b<=i){c++;$("span.sdl-number-links").append('<span title="'+b+'">'+b+"</span> ")}});$("span.sdl-number-links > span").each(function(){$(this).click(function(){if(parseInt($(this).attr("title"),10)!==f){f=parseInt($(this).attr("title"),10);k[1][1]=f>1?f-1:1;k[2][1]=f<i?f+1:i;h.updatePager();h.addRows(o);d.column!==""&&h.toggleColClass(o)}}).css("cursor","pointer")})};this.getData=function(){$("#"+l+" tr dl").each(function(a){a!==0&&$(this).children("dt").each(function(c){p[c].push([$(this).text(), n[a]])})})};this.addSortableLinks=function(a){$("#"+l+" tr.thead dt").each(function(c){p[c]=[];a[c]!==null&&$(this).click(function(){h.sort(c,a[c]);h.toggleClass(c,$(this))}).addClass("sortable-column").css("cursor","pointer")})};this.sort=function(a,c){q=true;p[a].sort(function(b,g){if(c==="caseSensitive"){b=b[0];g=g[0]}else if(c==="caseInsensitive"){b=b[0].toUpperCase();g=g[0].toUpperCase()}else if(c==="numeric"){b=parseFloat(b[0]);b=isNaN(b)?0:b;g=parseFloat(g[0]);g=isNaN(g)?0:g}return h.isASC($("tr.thead dt:eq("+ a+")"))?b<g?-1:b>g?1:0:b>g?-1:b<g?1:0});h.addRows(a);o=a};this.toggleColClass=function(a){if(q!==false){$("#"+l+" tr dt").each(function(){$(this).hasClass(d.column)&&$(this).removeClass(d.column)});setTimeout(function(){$("#"+l+" tr dt.col"+(parseInt(a,10)+1)).each(function(){$(this).parents("tr").hasClass("thead")||$(this).addClass(d.column)})},200)}};this.toggleClass=function(a,c){$("#"+l+" tr.thead dt").each(function(b){if(a===b)if(c.hasClass(d.asc)){c.addClass(d.desc);c.hasClass(d.asc)&&c.removeClass(d.asc)}else{c.addClass(d.asc); c.hasClass(d.desc)&&c.removeClass(d.desc)}else $(this).removeClass(d.asc+" "+d.desc)});d.column!==""&&h.toggleColClass(a)};this.isASC=function(a){return a.hasClass(d.asc)};this.getRows=function(){$("#"+l+" tr").each(function(a){n[a]=$(this)})};this.addRows=function(a){var c=(f-1)*e.items,b=c+e.items;h.removeRows();$.each(p[a],function(g,r){g>=c&&g<b&&$("#"+l).append(r[1])});$("span.sdl-number-links > span").removeClass("active-page");$("span.sdl-number-links > span").each(function(){parseInt($(this).attr("title"), 10)===f&&$(this).attr("class","active-page")})};this.removeRows=function(){$("#"+l+" tr").each(function(a){a>0&&$(this).remove()})}}}();