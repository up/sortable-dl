/** SortableDL (requires jQuery)
  * http://github.com/up/sortable-dl
  * Copyright (c) 2011 Uli Preuss
  * published under MIT License (http://www.opensource.org/licenses/mit-license.php)
*/
var SortableDL=function(){return function(){var p=[],k=[["sdl-first",1],["sdl-previous",1],["sdl-next",2],["sdl-last",null]],n=[],d={asc:"asc",desc:"desc",column:""},l="",e={items:null,numbers:null},i=1,g=1,o=0,r=false,j=null,m=null,h=this;this.init=function(b){l=b.id;j=b.classes;m=b.pagination;d.asc=j!==undefined&&j.asc!==undefined?j.asc:d.asc;d.desc=j!==undefined&&j.desc!==undefined?j.desc:d.desc;d.column=j!==undefined&&j.column!==undefined?j.column:d.column;e.items=m!==undefined&&m.items!==undefined? m.items:e.items;e.numbers=m!==undefined&&m.numbers!==undefined?m.numbers:e.numbers;this.getRows();this.countPages();k[3][1]=i;m!==undefined&&this.pagination();this.addSortableLinks(b.columns);this.getData();this.addRows(o)};this.countPages=function(){e.items=e.items!==null?e.items:n.length;i=Math.ceil((n.length-1)/e.items)};this.pagination=function(){$("span.sdl-matches").each(function(){$(this).html(n.length-1)});$("span.sdl-pages").each(function(){$(this).html(i)});if(i===1)$("span.sdl-links").css("display", "none");else{$.each(k,function(b){$("span."+k[b][0]).click(function(){g=k[b][1];if(g<=1)k[0][1]=1;k[1][1]=g>1?g-1:1;k[2][1]=g<i?g+1:i;h.updatePager();h.addRows(o);d.column!==""&&h.toggleColClass(o)}).css("cursor","pointer")});h.updatePager()}};this.updatePager=function(){var b=e.numbers!==null?Math.round((e.numbers-1)/2):0;e.numbers=e.numbers!==null?e.numbers:i;var c=0;$("span.sdl-number-links").empty();$.each(n,function(a){if(!(e.numbers<=c))if(e.numbers===null||a<=e.numbers&&a>=g-b||a<i-e.numbers+ b+1&&a>i-e.numbers&&a<=g+b||a>=g-b&&a<=g+b)if(a!==0&&a<=i){c++;$("span.sdl-number-links").append('<span title="'+a+'">'+a+"</span> ")}});$("span.sdl-number-links > span").each(function(){$(this).click(function(){if(parseInt($(this).attr("title"),10)!==g){g=parseInt($(this).attr("title"),10);k[1][1]=g>1?g-1:1;k[2][1]=g<i?g+1:i;h.updatePager();h.addRows(o);d.column!==""&&h.toggleColClass(o)}}).css("cursor","pointer")})};this.getData=function(){$("#"+l+" tr dl").each(function(b){b!==0&&$(this).children("dt").each(function(c){p[c].push([$(this).text(), n[b]])})})};this.addSortableLinks=function(b){$("#"+l+" tr.thead dt").each(function(c){p[c]=[];b[c]!==null&&$(this).click(function(){h.sort(c,b[c]);h.toggleClass(c,$(this))}).addClass("sortable-column").css("cursor","pointer")})};this.sort=function(b,c){r=true;p[b].sort(function(a,f){if(c==="caseSensitive"){a=a[0];f=f[0]}else if(c==="caseInsensitive"){a=a[0].toUpperCase();f=f[0].toUpperCase()}else if(c==="numeric"){a=parseFloat(a[0]);a=isNaN(a)?0:a;f=parseFloat(f[0]);f=isNaN(f)?0:f}else if(c==="date"){a= h.unixTimestamp(a[0]);f=h.unixTimestamp(f[0])}return h.isASC($("tr.thead dt:eq("+b+")"))?a<f?-1:a>f?1:0:a>f?-1:a<f?1:0});h.addRows(b);o=b};this.unixTimestamp=function(b){var c,a=function(q,s){if(typeof b==="string")return b.substring(q,s);return 0},f=(a(19,20)+(a(20,22)*60+a(23,25)*1))*6E4;if(typeof b==="number"||b===parseInt(b,10))return b;else if(typeof b==="string"&&(a(3,4)===" "||a(3,4)===","))return(new Date(b)).getTime();else{if(a(4,5)==="/"&&a(7,8)==="/"||a(4,5)==="-"&&a(7,8)==="-")c=Date.UTC(a(0, 4),a(5,7)-1,a(8,10),a(11,13),a(14,16),a(17,19));else if(a(2,3)==="/"&&a(5,6)==="/"||a(2,3)==="."&&a(5,6)===".")c=Date.UTC(a(6,10),a(3,5)-1,a(0,2),a(11,13),a(14,16),a(17,19));return c-f}};this.toggleColClass=function(b){if(r!==false){$("#"+l+" tr dt").each(function(){$(this).hasClass(d.column)&&$(this).removeClass(d.column)});setTimeout(function(){$("#"+l+" tr dt.col"+(parseInt(b,10)+1)).each(function(){$(this).parents("tr").hasClass("thead")||$(this).addClass(d.column)})},200)}};this.toggleClass= function(b,c){$("#"+l+" tr.thead dt").each(function(a){if(b===a)if(c.hasClass(d.asc)){c.addClass(d.desc);c.hasClass(d.asc)&&c.removeClass(d.asc)}else{c.addClass(d.asc);c.hasClass(d.desc)&&c.removeClass(d.desc)}else $(this).removeClass(d.asc+" "+d.desc)});d.column!==""&&h.toggleColClass(b)};this.isASC=function(b){return b.hasClass(d.asc)};this.getRows=function(){$("#"+l+" tr").each(function(b){n[b]=$(this)})};this.addRows=function(b){var c=(g-1)*e.items,a=c+e.items;h.removeRows();$.each(p[b],function(f, q){f>=c&&f<a&&$("#"+l).append(q[1])});$("span.sdl-number-links > span").removeClass("active-page");$("span.sdl-number-links > span").each(function(){parseInt($(this).attr("title"),10)===g&&$(this).attr("class","active-page")})};this.removeRows=function(){$("#"+l+" tr").each(function(b){b>0&&$(this).remove()})}}}();