/** SortableDL (requires jQuery)
  * http://github.com/up/sortable-dl
  * Copyright (c) 2011 Uli Preuss
  * published under MIT License (http://www.opensource.org/licenses/mit-license.php)
*/
var SortableDL=function(){return function(){var o=[],n=[],k=[["sdl-first",1],["sdl-previous",1],["sdl-next",2],["sdl-last",null]],d={asc:"asc",desc:"desc",page:"active-page",dt:"sortable-column",column:""},l="",g={items:null,numbers:null},i=1,e={page:1,col:0},r=false,p="descending",m=null,j=null,h=this;this.init=function(b){l=b.id;p=b.first!==undefined?b.first:p;j=b.classes;m=b.pagination;d.asc=j!==undefined&&j.asc!==undefined?j.asc:d.asc;d.desc=j!==undefined&&j.desc!==undefined?j.desc:d.desc;d.column= j!==undefined&&j.column!==undefined?j.column:d.column;g.items=m!==undefined&&m.items!==undefined?m.items:g.items;g.numbers=m!==undefined&&m.numbers!==undefined?m.numbers:g.numbers;this.getRows();this.countPages();k[3][1]=i;m!==undefined&&this.pagination();this.addSortableLinks(b.columns);this.getData();this.addRows(e.col)};this.countPages=function(){g.items=g.items!==null?g.items:n.length;i=Math.ceil((n.length-1)/g.items)};this.pagination=function(){$("span.sdl-matches").each(function(){$(this).html(n.length- 1)});$("span.sdl-pages").each(function(){$(this).html(i)});if(i===1)$("span.sdl-links").css("display","none");else{$.each(k,function(b){$("span."+k[b][0]).click(function(){e.page=k[b][1];if(e.page<=1)k[0][1]=1;k[1][1]=e.page>1?e.page-1:1;k[2][1]=e.page<i?e.page+1:i;h.updatePager();h.addRows(e.col);d.column!==""&&h.toggleColClass(e.col)}).css("cursor","pointer")});h.updatePager()}};this.updatePager=function(){var b=0,c=g.numbers!==null?Math.round((g.numbers-1)/2):0;g.numbers=g.numbers!==null?g.numbers: i;$("span.sdl-number-links").empty();$.each(n,function(a){if(!(g.numbers<=b))if((g.numbers===null||a<=g.numbers&&a>=e.page-c||a<i-g.numbers+c+1&&a>i-g.numbers&&a<=e.page+c||a>=e.page-c&&a<=e.page+c)&&a!==0&&a<=i){b+=1;$("span.sdl-number-links").append('<span title="'+a+'">'+a+"</span> ")}});$("span.sdl-number-links > span").each(function(){$(this).click(function(){if(parseInt($(this).attr("title"),10)!==e.page){e.page=parseInt($(this).attr("title"),10);k[1][1]=e.page>1?e.page-1:1;k[2][1]=e.page<i? e.page+1:i;h.updatePager();h.addRows(e.col);d.column!==""&&h.toggleColClass(e.col)}}).css("cursor","pointer")})};this.getData=function(){$("#"+l+" tr dl").each(function(b){b!==0&&$(this).children("dt").each(function(c){o[c].push([$(this).text(),n[b]])})})};this.addSortableLinks=function(b){$("#"+l+" thead dt").each(function(c){o[c]=[];b[c]!==null&&$(this).click(function(){h.sort(c,b[c]);h.toggleClass(c,$(this))}).addClass(d.dt).css("cursor","pointer")})};this.sort=function(b,c){r=true;o[b].sort(function(a, f){if(c==="caseSensitive"){a=a[0];f=f[0]}else if(c==="caseInsensitive"){a=a[0].toUpperCase();f=f[0].toUpperCase()}else if(c==="numeric"){a=parseFloat(a[0]);a=isNaN(a)?0:a;f=parseFloat(f[0]);f=isNaN(f)?0:f}else if(c==="date"){a=h.unixTimestamp(a[0]);f=h.unixTimestamp(f[0])}return h.isASC($("thead dt:eq("+b+")"))?a<f?-1:a>f?1:0:a>f?-1:a<f?1:0});h.addRows(b);e.col=b};this.unixTimestamp=function(b){var c,a=function(q,s){if(typeof b==="string")return b.substring(q,s);return 0},f=(a(19,20)+(a(20,22)*60+ a(23,25)))*6E4;if(typeof b==="number"||b===parseInt(b,10))return b;else if(typeof b==="string"&&(a(3,4)===" "||a(3,4)===","))return(new Date(b)).getTime();else{if(a(4,5)==="/"&&a(7,8)==="/"||a(4,5)==="-"&&a(7,8)==="-")c=Date.UTC(a(0,4),a(5,7)-1,a(8,10),a(11,13),a(14,16),a(17,19));else if(a(2,3)==="/"&&a(5,6)==="/"||a(2,3)==="."&&a(5,6)===".")c=Date.UTC(a(6,10),a(3,5)-1,a(0,2),a(11,13),a(14,16),a(17,19));return c-f}};this.toggleColClass=function(b){if(r!==false){var c=$("#"+l+" tr dt").nextAll(),a= c.length-1;c.each(function(f){$(this).hasClass(d.column)&&$(this).removeClass(d.column);f===a&&$("#"+l+" tr dt.col"+(parseInt(b,10)+1)).each(function(){$(this).parents("tbody")&&$(this).addClass(d.column)})})}};this.toggleClass=function(b,c){$("#"+l+" thead dt").each(function(a){if(b===a)if(c.hasClass(d.asc)){c.addClass(d.desc);c.hasClass(d.asc)&&c.removeClass(d.asc)}else{c.addClass(d.asc);c.hasClass(d.desc)&&c.removeClass(d.desc)}else $(this).removeClass(d.asc+" "+d.desc)});d.column!==""&&h.toggleColClass(b)}; this.isASC=function(b){if(p==="descending")return b.hasClass(d.asc);else if(p==="ascending")return!b.hasClass(d.asc)};this.getRows=function(){$("#"+l+" tr").each(function(b){n[b]=$(this)})};this.addRows=function(b){var c=(e.page-1)*g.items,a=c+g.items;h.removeRows();$.each(o[b],function(f,q){f>=c&&f<a&&$("#"+l).append(q[1])});$("span.sdl-number-links > span").removeClass(d.page);$("span.sdl-number-links > span").each(function(){parseInt($(this).attr("title"),10)===e.page&&$(this).attr("class",d.page)})}; this.removeRows=function(){$("#"+l+" tr").each(function(b){b>0&&$(this).remove()})}}}();